{
  "hash": "0fc74728f37cbce9e6dc0db879fa3e37",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Tasa de Ingresos 2015-2025, INEGI (ENOE)\"\neditor: visual\noutput-file: tasa-final-de-ingresos.html\n---\n\n```{=html}\n<div class=\"description\">\n        <p>El presente proyecto es un ejemplo de la aplicación de diseño muestral en la encuesta de la ENOE del INEGI para calcular las tasas anuales del ingreso en México durante un periodo de 10 años  (2015 al 2025).\n      </p>\n```\n\n```{=html}\n<div class=\"description\">\nLas librerías que usaremos serán las siguientes:\n      </p>\n```\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(survey)\nlibrary(ggplot2)\n```\n:::\n\n\n```{=html}\n<div class=\"description\">\n    <p>\n        Para obtener las bases de datos necesarias, puedes descargarlas aquí:\n        <a href=\"https://www.inegi.org.mx/programas/enoe/15ymas/#Microdatos\" target=\"_blank\">\n            Encuesta Nacional de Ocupación y Empleo (ENOE), población de 15 años y más de edad\n        </a>\n        .\n    </p>\n</div>\n```\n\n```{=html}\n<div class=\"description\">\nPara cargar las bases necesitamos crear las rutas y establecer unos valores para poner automatizar el trabajo.\n      </p>\n```\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Asegúrate de reemplazar el código con la ruta en la que tienes los documentos.\nruta<- \"C:/Users/USER/Downloads/Bases de datos/INEGI/ENOE SDME 2015 a 2025/conjunto_de_datos_sdem_enoe_\"\naños<- 2015:2025\ntrimestres<-1:4\n```\n:::\n\n\n```{=html}\n<div class=\"description\">\nCon esto podemos emplear el bucle para abrir las bases de datos.\n      </p>\n```\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfor (año in años) {\n  for (trimestre in trimestres) {\n    \n    nombre_archivo <- paste0(ruta, año, \"_\", trimestre, \"t.csv\")\n    nombre_variable <- paste0(\"Enoe_\", año, \"_T\", trimestre)\n    \n    # Intenta leer el archivo y asignarlo\n    tryCatch({\n      \n      assign(nombre_variable, read.csv(nombre_archivo))\n      cat(\"✅ Éxito al cargar:\", nombre_variable, \"\\n\")\n      \n    }, error = function(e) {\n      \n      # Si ocurre un error (como que el archivo no existe), ejecuta esto\n      cat(\"⚠️ AVISO: No se pudo cargar el archivo:\", nombre_archivo, \"\\n\")\n      \n      # Puedes añadir una condición específica si es el 2020 T2 para un mensaje claro\n      if (año == 2020 & trimestre == 2) {\n        cat(\"   * Razón: Archivo omitido intencionalmente (encuesta no realizada en T2 2020).\", \"\\n\")\n      } else {\n        cat(\"   * Mensaje de error:\", conditionMessage(e), \"\\n\")\n      }\n      cat(\"\\n\") # Salto de línea para separar las iteraciones\n      \n    })\n    \n    # El bucle sigue automáticamente con la siguiente iteración sin detenerse\n  }\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n✅ Éxito al cargar: Enoe_2015_T1 \n✅ Éxito al cargar: Enoe_2015_T2 \n✅ Éxito al cargar: Enoe_2015_T3 \n✅ Éxito al cargar: Enoe_2015_T4 \n✅ Éxito al cargar: Enoe_2016_T1 \n✅ Éxito al cargar: Enoe_2016_T2 \n✅ Éxito al cargar: Enoe_2016_T3 \n✅ Éxito al cargar: Enoe_2016_T4 \n✅ Éxito al cargar: Enoe_2017_T1 \n✅ Éxito al cargar: Enoe_2017_T2 \n✅ Éxito al cargar: Enoe_2017_T3 \n✅ Éxito al cargar: Enoe_2017_T4 \n✅ Éxito al cargar: Enoe_2018_T1 \n✅ Éxito al cargar: Enoe_2018_T2 \n✅ Éxito al cargar: Enoe_2018_T3 \n✅ Éxito al cargar: Enoe_2018_T4 \n✅ Éxito al cargar: Enoe_2019_T1 \n✅ Éxito al cargar: Enoe_2019_T2 \n✅ Éxito al cargar: Enoe_2019_T3 \n✅ Éxito al cargar: Enoe_2019_T4 \n✅ Éxito al cargar: Enoe_2020_T1 \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in file(file, \"rt\"): no fue posible abrir el archivo\n'C:/Users/USER/Downloads/Bases de datos/INEGI/ENOE SDME 2015 a\n2025/conjunto_de_datos_sdem_enoe_2020_2t.csv': No such file or directory\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n⚠️ AVISO: No se pudo cargar el archivo: C:/Users/USER/Downloads/Bases de datos/INEGI/ENOE SDME 2015 a 2025/conjunto_de_datos_sdem_enoe_2020_2t.csv \n   * Razón: Archivo omitido intencionalmente (encuesta no realizada en T2 2020). \n\n✅ Éxito al cargar: Enoe_2020_T3 \n✅ Éxito al cargar: Enoe_2020_T4 \n✅ Éxito al cargar: Enoe_2021_T1 \n✅ Éxito al cargar: Enoe_2021_T2 \n✅ Éxito al cargar: Enoe_2021_T3 \n✅ Éxito al cargar: Enoe_2021_T4 \n✅ Éxito al cargar: Enoe_2022_T1 \n✅ Éxito al cargar: Enoe_2022_T2 \n✅ Éxito al cargar: Enoe_2022_T3 \n✅ Éxito al cargar: Enoe_2022_T4 \n✅ Éxito al cargar: Enoe_2023_T1 \n✅ Éxito al cargar: Enoe_2023_T2 \n✅ Éxito al cargar: Enoe_2023_T3 \n✅ Éxito al cargar: Enoe_2023_T4 \n✅ Éxito al cargar: Enoe_2024_T1 \n✅ Éxito al cargar: Enoe_2024_T2 \n✅ Éxito al cargar: Enoe_2024_T3 \n✅ Éxito al cargar: Enoe_2024_T4 \n✅ Éxito al cargar: Enoe_2025_T1 \n✅ Éxito al cargar: Enoe_2025_T2 \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in file(file, \"rt\"): no fue posible abrir el archivo\n'C:/Users/USER/Downloads/Bases de datos/INEGI/ENOE SDME 2015 a\n2025/conjunto_de_datos_sdem_enoe_2025_3t.csv': No such file or directory\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n⚠️ AVISO: No se pudo cargar el archivo: C:/Users/USER/Downloads/Bases de datos/INEGI/ENOE SDME 2015 a 2025/conjunto_de_datos_sdem_enoe_2025_3t.csv \n   * Mensaje de error: no se puede abrir la conexión \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in file(file, \"rt\"): no fue posible abrir el archivo\n'C:/Users/USER/Downloads/Bases de datos/INEGI/ENOE SDME 2015 a\n2025/conjunto_de_datos_sdem_enoe_2025_4t.csv': No such file or directory\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n⚠️ AVISO: No se pudo cargar el archivo: C:/Users/USER/Downloads/Bases de datos/INEGI/ENOE SDME 2015 a 2025/conjunto_de_datos_sdem_enoe_2025_4t.csv \n   * Mensaje de error: no se puede abrir la conexión \n```\n\n\n:::\n:::\n\n\n```{=html}\n<div class=\"description\">\n<strong>Notas importantes:</strong> el código está pensado para arrojar mensajes de \"Exito al cargar\" y \"Aviso: no se pudo cargar\". Para el trimestre 2 del año 2020, debido a la pandemia, no existen datos de la ENOE. Lo mismo pasa para los trimestres 3 y 4 del 2025 (debido a que aún no existen datos).\n      </p>\n```\n\n```{=html}\n<div class=\"description\">\nLo siguiente es preparar los datos. Para ello, vamos a hacer tres pasos importantes: filtrar los datos por ingresos superiores a 0, aplicar diseño muestral y calcular la media y los intervalos de confianza. Para ello, creamos un bucle que almacenará los estadísticos resultantes en un sólo dataframe.\n      </p>\n```\n\n```{=html}\n<div class=\"description\">\nNotas: \n  *El diseño muestral presenta variaciones en las variables, por lo que es necesario ajustar el bucle.\n  *Es necesario emplear el diseño muestral mediante svy para tener datos más precisos.\n      </p>\n```\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Creamos un data frame que contendrá los resultados de la iteración\nserie_ingreso_total <- data.frame()\n\nfor (año in años) {\n  for (trimestre in trimestres) {\n    \n    nombre_df <- paste0(\"Enoe_\", año, \"_T\", trimestre)\n    \n    # --- Ajuste Condicional del Factor de Peso ---\n    if (año > 2020 | (año == 2020 & trimestre >= 2)) {\n      peso_actual_str <- \"fac_tri\" \n      peso_antiguo_str <- \"FAC_TRI\" \n    } else {\n      peso_actual_str <- \"fac\"\n      peso_antiguo_str <- \"FAC\" \n    }\n    # ---------------------------------------------\n    \n    tryCatch({\n      \n      df_actual <- get(nombre_df)\n      \n      \n      #  Corrección: UPM (mayúsculas) a upm (minúsculas)\n      if (!(\"upm\" %in% names(df_actual)) && (\"UPM\" %in% names(df_actual))) {\n        df_actual <- df_actual %>% rename(upm = UPM) \n      } \n      \n      # NUEVA CORRECCIÓN: EST (mayúsculas) a est (minúsculas)\n      if (!(\"est\" %in% names(df_actual)) && (\"EST\" %in% names(df_actual))) {\n        df_actual <- df_actual %>% rename(est = EST) \n        cat(paste(\"   * AVISO: Columna 'EST' renombrada a 'est' en\", nombre_df, \"\\n\"))\n      } \n      \n      # Corrección: Variable de Ingreso (ingocup / INGOCUP)\n      if (!(\"ingocup\" %in% names(df_actual))) {\n        if (\"inglab\" %in% names(df_actual)) {\n          df_actual <- df_actual %>% rename(ingocup = inglab)\n        } else if (\"INGOCUP\" %in% names(df_actual)) {\n          df_actual <- df_actual %>% rename(ingocup = INGOCUP)\n        } \n      } \n      \n      # Corrección: Factor de Ponderación (FAC / FAC_TRI) a minúsculas\n      if (!(peso_actual_str %in% names(df_actual)) && (peso_antiguo_str %in% names(df_actual))) {\n        # Usamos := y !!sym() para renombrar la variable de texto\n        df_actual <- df_actual %>% rename(!!sym(peso_actual_str) := !!sym(peso_antiguo_str))\n      }\n      # =======================================================\n    \n      # A. Filtrado y Preparación\n      df_filt <- df_actual %>%\n        filter(ingocup > 0, !is.na(ingocup)) \n      \n      # B. Diseño Muestral y Ponderación\n      formula_peso <- as.formula(paste0(\"~\", peso_actual_str))\n      \n      diseno_actual <- svydesign(\n        ids = ~upm, \n        strata = ~est, # Ahora 'est' existe\n        data = df_filt, \n        weights = formula_peso,\n        nest = TRUE ##Para muestras con un solo estrato\n      )\n      \n      # C. Cálculo de Media e IC\n      media_ponderada <- svymean(~ingocup, diseno_actual, na.rm = TRUE)\n      ic_95 <- confint(media_ponderada)\n      \n      # D. Almacenar resultados\n      tabla_temp <- data.frame(\n        Año = año,\n        Trimestre = trimestre,\n        Media = as.numeric(media_ponderada[1]),\n        IC_Inferior = as.numeric(ic_95[1]),\n        IC_Superior = as.numeric(ic_95[2])\n      )\n      \n      # E. Consolidar\n      serie_ingreso_total <- bind_rows(serie_ingreso_total, tabla_temp) #Apila los resultados\n      \n      cat(paste(\"✅ Éxito:\", nombre_df, \"procesado usando peso:\", peso_actual_str, \"\\n\"))\n      \n    }, error = function(e) {\n      cat(paste(\"⚠️ Omitido:\", nombre_df, \"– Error:\", conditionMessage(e), \"\\n\"))\n    })\n    \n  }\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n✅ Éxito: Enoe_2015_T1 procesado usando peso: fac \n✅ Éxito: Enoe_2015_T2 procesado usando peso: fac \n✅ Éxito: Enoe_2015_T3 procesado usando peso: fac \n✅ Éxito: Enoe_2015_T4 procesado usando peso: fac \n✅ Éxito: Enoe_2016_T1 procesado usando peso: fac \n✅ Éxito: Enoe_2016_T2 procesado usando peso: fac \n✅ Éxito: Enoe_2016_T3 procesado usando peso: fac \n✅ Éxito: Enoe_2016_T4 procesado usando peso: fac \n✅ Éxito: Enoe_2017_T1 procesado usando peso: fac \n✅ Éxito: Enoe_2017_T2 procesado usando peso: fac \n✅ Éxito: Enoe_2017_T3 procesado usando peso: fac \n✅ Éxito: Enoe_2017_T4 procesado usando peso: fac \n✅ Éxito: Enoe_2018_T1 procesado usando peso: fac \n✅ Éxito: Enoe_2018_T2 procesado usando peso: fac \n✅ Éxito: Enoe_2018_T3 procesado usando peso: fac \n✅ Éxito: Enoe_2018_T4 procesado usando peso: fac \n✅ Éxito: Enoe_2019_T1 procesado usando peso: fac \n✅ Éxito: Enoe_2019_T2 procesado usando peso: fac \n   * AVISO: Columna 'EST' renombrada a 'est' en Enoe_2019_T3 \n✅ Éxito: Enoe_2019_T3 procesado usando peso: fac \n   * AVISO: Columna 'EST' renombrada a 'est' en Enoe_2019_T4 \n✅ Éxito: Enoe_2019_T4 procesado usando peso: fac \n✅ Éxito: Enoe_2020_T1 procesado usando peso: fac \n⚠️ Omitido: Enoe_2020_T2 – Error: objeto 'Enoe_2020_T2' no encontrado \n✅ Éxito: Enoe_2020_T3 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2020_T4 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2021_T1 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2021_T2 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2021_T3 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2021_T4 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2022_T1 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2022_T2 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2022_T3 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2022_T4 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2023_T1 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2023_T2 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2023_T3 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2023_T4 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2024_T1 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2024_T2 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2024_T3 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2024_T4 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2025_T1 procesado usando peso: fac_tri \n✅ Éxito: Enoe_2025_T2 procesado usando peso: fac_tri \n⚠️ Omitido: Enoe_2025_T3 – Error: objeto 'Enoe_2025_T3' no encontrado \n⚠️ Omitido: Enoe_2025_T4 – Error: objeto 'Enoe_2025_T4' no encontrado \n```\n\n\n:::\n\n```{.r .cell-code}\nserie_ingreso_total\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Año Trimestre     Media IC_Inferior IC_Superior\n1  2015         1  5244.229    5179.958    5308.500\n2  2015         2  5282.406    5211.691    5353.121\n3  2015         3  5404.859    5319.517    5490.202\n4  2015         4  5375.187    5295.195    5455.178\n5  2016         1  5483.318    5412.380    5554.256\n6  2016         2  5527.432    5446.271    5608.593\n7  2016         3  5621.110    5534.157    5708.062\n8  2016         4  5659.809    5585.124    5734.494\n9  2017         1  5766.061    5698.463    5833.659\n10 2017         2  5821.228    5748.470    5893.986\n11 2017         3  5836.968    5762.706    5911.230\n12 2017         4  5862.350    5793.351    5931.349\n13 2018         1  6036.973    5961.802    6112.143\n14 2018         2  6118.144    6043.262    6193.026\n15 2018         3  6149.726    6071.686    6227.766\n16 2018         4  6188.929    6114.583    6263.275\n17 2019         1  6313.772    6244.581    6382.962\n18 2019         2  6352.562    6280.693    6424.430\n19 2019         3  6400.166    6330.194    6470.138\n20 2019         4  6542.009    6468.949    6615.069\n21 2020         1  6824.549    6742.125    6906.973\n22 2020         3  6758.452    6647.461    6869.442\n23 2020         4  6883.805    6783.932    6983.679\n24 2021         1  7129.192    7026.347    7232.038\n25 2021         2  7178.877    7069.607    7288.146\n26 2021         3  7394.624    7273.187    7516.060\n27 2021         4  7390.662    7296.842    7484.481\n28 2022         1  7666.625    7572.763    7760.487\n29 2022         2  7795.795    7700.024    7891.567\n30 2022         3  7841.819    7755.248    7928.390\n31 2022         4  8018.257    7927.119    8109.394\n32 2023         1  8425.237    8329.190    8521.283\n33 2023         2  8592.474    8488.112    8696.835\n34 2023         3  8787.320    8684.732    8889.909\n35 2023         4  8882.002    8773.506    8990.499\n36 2024         1  9323.537    9210.346    9436.727\n37 2024         2  9507.358    9374.830    9639.886\n38 2024         3  9716.547    9535.681    9897.412\n39 2024         4  9812.097    9679.125    9945.068\n40 2025         1 10132.974    9974.131   10291.816\n41 2025         2 10221.150   10088.949   10353.351\n```\n\n\n:::\n:::\n\n\n```{=html}\n<div class=\"description\">\nCreamos una columna para la fecha y para la etiqueta de las medias ponderadas.\n      </p>\n```\n\n\n::: {.cell}\n\n```{.r .cell-code}\nserie_ENOE15_25<-serie_ingreso_total%>%\n  mutate(\n    Fecha=as.Date(paste(Año, Trimestre *3-2, 1, sep = \"-\"), format=\"%Y-%m-%d\"), #Establecemos el formato fecha para las series de tiempo\n    Etiqueta_Media = format(round(Media, 2), big.mark = \",\", decimal.mark = \".\", scientific = FALSE) #Creamos una etiqueta para visualizarla en la serie\n  ) %>%\n  arrange(Fecha)\nserie_ENOE15_25\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Año Trimestre     Media IC_Inferior IC_Superior      Fecha Etiqueta_Media\n1  2015         1  5244.229    5179.958    5308.500 2015-01-01       5,244.23\n2  2015         2  5282.406    5211.691    5353.121 2015-04-01       5,282.41\n3  2015         3  5404.859    5319.517    5490.202 2015-07-01       5,404.86\n4  2015         4  5375.187    5295.195    5455.178 2015-10-01       5,375.19\n5  2016         1  5483.318    5412.380    5554.256 2016-01-01       5,483.32\n6  2016         2  5527.432    5446.271    5608.593 2016-04-01       5,527.43\n7  2016         3  5621.110    5534.157    5708.062 2016-07-01       5,621.11\n8  2016         4  5659.809    5585.124    5734.494 2016-10-01       5,659.81\n9  2017         1  5766.061    5698.463    5833.659 2017-01-01       5,766.06\n10 2017         2  5821.228    5748.470    5893.986 2017-04-01       5,821.23\n11 2017         3  5836.968    5762.706    5911.230 2017-07-01       5,836.97\n12 2017         4  5862.350    5793.351    5931.349 2017-10-01       5,862.35\n13 2018         1  6036.973    5961.802    6112.143 2018-01-01       6,036.97\n14 2018         2  6118.144    6043.262    6193.026 2018-04-01       6,118.14\n15 2018         3  6149.726    6071.686    6227.766 2018-07-01       6,149.73\n16 2018         4  6188.929    6114.583    6263.275 2018-10-01       6,188.93\n17 2019         1  6313.772    6244.581    6382.962 2019-01-01       6,313.77\n18 2019         2  6352.562    6280.693    6424.430 2019-04-01       6,352.56\n19 2019         3  6400.166    6330.194    6470.138 2019-07-01       6,400.17\n20 2019         4  6542.009    6468.949    6615.069 2019-10-01       6,542.01\n21 2020         1  6824.549    6742.125    6906.973 2020-01-01       6,824.55\n22 2020         3  6758.452    6647.461    6869.442 2020-07-01       6,758.45\n23 2020         4  6883.805    6783.932    6983.679 2020-10-01       6,883.81\n24 2021         1  7129.192    7026.347    7232.038 2021-01-01       7,129.19\n25 2021         2  7178.877    7069.607    7288.146 2021-04-01       7,178.88\n26 2021         3  7394.624    7273.187    7516.060 2021-07-01       7,394.62\n27 2021         4  7390.662    7296.842    7484.481 2021-10-01       7,390.66\n28 2022         1  7666.625    7572.763    7760.487 2022-01-01       7,666.63\n29 2022         2  7795.795    7700.024    7891.567 2022-04-01       7,795.80\n30 2022         3  7841.819    7755.248    7928.390 2022-07-01       7,841.82\n31 2022         4  8018.257    7927.119    8109.394 2022-10-01       8,018.26\n32 2023         1  8425.237    8329.190    8521.283 2023-01-01       8,425.24\n33 2023         2  8592.474    8488.112    8696.835 2023-04-01       8,592.47\n34 2023         3  8787.320    8684.732    8889.909 2023-07-01       8,787.32\n35 2023         4  8882.002    8773.506    8990.499 2023-10-01       8,882.00\n36 2024         1  9323.537    9210.346    9436.727 2024-01-01       9,323.54\n37 2024         2  9507.358    9374.830    9639.886 2024-04-01       9,507.36\n38 2024         3  9716.547    9535.681    9897.412 2024-07-01       9,716.55\n39 2024         4  9812.097    9679.125    9945.068 2024-10-01       9,812.10\n40 2025         1 10132.974    9974.131   10291.816 2025-01-01      10,132.97\n41 2025         2 10221.150   10088.949   10353.351 2025-04-01      10,221.15\n```\n\n\n:::\n:::\n\n\n```{=html}\n<div class=\"description\">\n  Graficamos en una serie de tiempo el ingreso ponderado con los intervalos de confianza.\n</div>\n```\n\n\n::: {.cell}\n\n```{.r .cell-code}\nserie_tiempo_enoe<-ggplot(serie_ENOE15_25, aes(x=Fecha,  y= Media))+\n  geom_ribbon(\n    aes(ymin= IC_Inferior, ymax=IC_Superior), #Nos muestra los intervalos de confianza\n    fill=\"#0072B2\",\n    alpha = 0.2,\n  )+\n  geom_line(color=\"#0072B2\", size = 1) +\n  geom_text(\n    # Muestra la etiqueta solo si es el primer trimestre del año (o el único visible)\n    data = subset(serie_ENOE15_25, Trimestre == 1 | Fecha == max(Fecha)), \n    aes(label = Etiqueta_Media),\n    vjust = -1, # Posiciona la etiqueta ligeramente por encima del punto\n    size = 3.5,\n    color = \"black\"\n  ) +\n  \n  # D. Ajustar el Eje X para mostrar los extremos\n  scale_x_date(\n    breaks = \"1 year\", # Marcas principales cada año\n    date_labels = \"%Y\", # Formato de la etiqueta: solo el año (ej. 2015)\n    limits = as.Date(c(\"2014-12-01\", \"2026-03-01\")) # **LÍMITES AMPLIADOS**\n  ) +\n  labs(\n    title = \"Ingreso Laboral Promedio en México (2015-2025)\",\n    subtitle = \"Media con Intervalo de Confianza del 95%\",\n    x = \"Año(Trimestre)\",\n    y = \"Ingreso Promedio Ponderado (MXN)\",\n    caption = \"Fuente: Elaboración propia a partir de INEGI ENOE 2015 al 2025\"\n  ) +\n  theme_minimal() +\n  scale_y_continuous(labels = scales::comma) # Formato de miles para el eje Y\nserie_tiempo_enoe\n```\n\n::: {.cell-output-display}\n![](Tasa-de-ingresos_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n```{=html}\n<div class=\"description\">\n  Ahora calculamos la tasa de variación trimestral y la tasa anual.\n</div> \n```\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Tasa trimestral\ntasa_inc_ENOE<-serie_ENOE15_25%>%\n  arrange(Fecha)%>% # Asegurarse de que esté ordenada cronológicamente\n  mutate(\n    Media_Anterior = lag(Media, n = 1),\n    \n    # 2. Calcular la Tasa de Variación Trimestral (TVT)\n    Tasa_Trimestral = ((Media - Media_Anterior) / Media_Anterior) * 100,\n    \n    # Formato para la visualización\n    Tasa_Trimestral_Etiqueta = paste0(round(Tasa_Trimestral, 2), \"%\")\n  )\n#Calculamos la tasa de variación anual\ntasa_inc_ENOE<-tasa_inc_ENOE%>%\n  mutate(\n    # 1. Obtener la media del mismo trimestre del año anterior (t-4)\n    Media_Anual_Anterior = lag(Media, n = 4),\n    \n    # 2. Calcular la Tasa de Variación Anual (TVA)\n    Tasa_Anual = ((Media - Media_Anual_Anterior) / Media_Anual_Anterior) * 100,\n    \n    # Formato para la visualización\n    Tasa_Anual_Etiqueta = paste0(round(Tasa_Anual, 2), \"%\")\n  )\n\ntasa_inc_ENOE\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Año Trimestre     Media IC_Inferior IC_Superior      Fecha Etiqueta_Media\n1  2015         1  5244.229    5179.958    5308.500 2015-01-01       5,244.23\n2  2015         2  5282.406    5211.691    5353.121 2015-04-01       5,282.41\n3  2015         3  5404.859    5319.517    5490.202 2015-07-01       5,404.86\n4  2015         4  5375.187    5295.195    5455.178 2015-10-01       5,375.19\n5  2016         1  5483.318    5412.380    5554.256 2016-01-01       5,483.32\n6  2016         2  5527.432    5446.271    5608.593 2016-04-01       5,527.43\n7  2016         3  5621.110    5534.157    5708.062 2016-07-01       5,621.11\n8  2016         4  5659.809    5585.124    5734.494 2016-10-01       5,659.81\n9  2017         1  5766.061    5698.463    5833.659 2017-01-01       5,766.06\n10 2017         2  5821.228    5748.470    5893.986 2017-04-01       5,821.23\n11 2017         3  5836.968    5762.706    5911.230 2017-07-01       5,836.97\n12 2017         4  5862.350    5793.351    5931.349 2017-10-01       5,862.35\n13 2018         1  6036.973    5961.802    6112.143 2018-01-01       6,036.97\n14 2018         2  6118.144    6043.262    6193.026 2018-04-01       6,118.14\n15 2018         3  6149.726    6071.686    6227.766 2018-07-01       6,149.73\n16 2018         4  6188.929    6114.583    6263.275 2018-10-01       6,188.93\n17 2019         1  6313.772    6244.581    6382.962 2019-01-01       6,313.77\n18 2019         2  6352.562    6280.693    6424.430 2019-04-01       6,352.56\n19 2019         3  6400.166    6330.194    6470.138 2019-07-01       6,400.17\n20 2019         4  6542.009    6468.949    6615.069 2019-10-01       6,542.01\n21 2020         1  6824.549    6742.125    6906.973 2020-01-01       6,824.55\n22 2020         3  6758.452    6647.461    6869.442 2020-07-01       6,758.45\n23 2020         4  6883.805    6783.932    6983.679 2020-10-01       6,883.81\n24 2021         1  7129.192    7026.347    7232.038 2021-01-01       7,129.19\n25 2021         2  7178.877    7069.607    7288.146 2021-04-01       7,178.88\n26 2021         3  7394.624    7273.187    7516.060 2021-07-01       7,394.62\n27 2021         4  7390.662    7296.842    7484.481 2021-10-01       7,390.66\n28 2022         1  7666.625    7572.763    7760.487 2022-01-01       7,666.63\n29 2022         2  7795.795    7700.024    7891.567 2022-04-01       7,795.80\n30 2022         3  7841.819    7755.248    7928.390 2022-07-01       7,841.82\n31 2022         4  8018.257    7927.119    8109.394 2022-10-01       8,018.26\n32 2023         1  8425.237    8329.190    8521.283 2023-01-01       8,425.24\n33 2023         2  8592.474    8488.112    8696.835 2023-04-01       8,592.47\n34 2023         3  8787.320    8684.732    8889.909 2023-07-01       8,787.32\n35 2023         4  8882.002    8773.506    8990.499 2023-10-01       8,882.00\n36 2024         1  9323.537    9210.346    9436.727 2024-01-01       9,323.54\n37 2024         2  9507.358    9374.830    9639.886 2024-04-01       9,507.36\n38 2024         3  9716.547    9535.681    9897.412 2024-07-01       9,716.55\n39 2024         4  9812.097    9679.125    9945.068 2024-10-01       9,812.10\n40 2025         1 10132.974    9974.131   10291.816 2025-01-01      10,132.97\n41 2025         2 10221.150   10088.949   10353.351 2025-04-01      10,221.15\n   Media_Anterior Tasa_Trimestral Tasa_Trimestral_Etiqueta Media_Anual_Anterior\n1              NA              NA                      NA%                   NA\n2        5244.229      0.72798470                    0.73%                   NA\n3        5282.406      2.31812899                    2.32%                   NA\n4        5404.859     -0.54900383                   -0.55%                   NA\n5        5375.187      2.01168662                    2.01%             5244.229\n6        5483.318      0.80450744                     0.8%             5282.406\n7        5527.432      1.69477244                    1.69%             5404.859\n8        5621.110      0.68847452                    0.69%             5375.187\n9        5659.809      1.87729552                    1.88%             5483.318\n10       5766.061      0.95675689                    0.96%             5527.432\n11       5821.228      0.27039375                    0.27%             5621.110\n12       5836.968      0.43484723                    0.43%             5659.809\n13       5862.350      2.97871343                    2.98%             5766.061\n14       6036.973      1.34456378                    1.34%             5821.228\n15       6118.144      0.51620660                    0.52%             5836.968\n16       6149.726      0.63747724                    0.64%             5862.350\n17       6188.929      2.01719141                    2.02%             6036.973\n18       6313.772      0.61437370                    0.61%             6118.144\n19       6352.562      0.74936959                    0.75%             6149.726\n20       6400.166      2.21623483                    2.22%             6188.929\n21       6542.009      4.31886613                    4.32%             6313.772\n22       6824.549     -0.96852510                   -0.97%             6352.562\n23       6758.452      1.85476715                    1.85%             6400.166\n24       6883.805      3.56470081                    3.56%             6542.009\n25       7129.192      0.69691346                     0.7%             6824.549\n26       7178.877      3.00530146                    3.01%             6758.452\n27       7394.624     -0.05357744                   -0.05%             6883.805\n28       7390.662      3.73394787                    3.73%             7129.192\n29       7666.625      1.68483516                    1.68%             7178.877\n30       7795.795      0.59036636                    0.59%             7394.624\n31       7841.819      2.24995811                    2.25%             7390.662\n32       8018.257      5.07566913                    5.08%             7666.625\n33       8425.237      1.98495184                    1.98%             7795.795\n34       8592.474      2.26764272                    2.27%             7841.819\n35       8787.320      1.07748697                    1.08%             8018.257\n36       8882.002      4.97111306                    4.97%             8425.237\n37       9323.537      1.97158388                    1.97%             8592.474\n38       9507.358      2.20027956                     2.2%             8787.320\n39       9716.547      0.98337705                    0.98%             8882.002\n40       9812.097      3.27021688                    3.27%             9323.537\n41      10132.974      0.87019183                    0.87%             9507.358\n   Tasa_Anual Tasa_Anual_Etiqueta\n1          NA                 NA%\n2          NA                 NA%\n3          NA                 NA%\n4          NA                 NA%\n5    4.559091               4.56%\n6    4.638525               4.64%\n7    4.001031                  4%\n8    5.295126                5.3%\n9    5.156410               5.16%\n10   5.315232               5.32%\n11   3.840144               3.84%\n12   3.578577               3.58%\n13   4.698388                4.7%\n14   5.100568                5.1%\n15   5.358222               5.36%\n16   5.570785               5.57%\n17   4.585061               4.59%\n18   3.831523               3.83%\n19   4.072376               4.07%\n20   5.705019               5.71%\n21   8.089897               8.09%\n22   6.389391               6.39%\n23   7.556669               7.56%\n24   8.975588               8.98%\n25   5.191954               5.19%\n26   9.412981               9.41%\n27   7.363026               7.36%\n28   7.538481               7.54%\n29   8.593524               8.59%\n30   6.047574               6.05%\n31   8.491727               8.49%\n32   9.894987               9.89%\n33  10.219335              10.22%\n34  12.057168              12.06%\n35  10.772241              10.77%\n36  10.662016              10.66%\n37  10.647511              10.65%\n38  10.574628              10.57%\n39  10.471676              10.47%\n40   8.681651               8.68%\n41   7.507784               7.51%\n```\n\n\n:::\n:::\n\n\n```{=html}\n<div class=\"description\">\n  Finalmente graficamos la tasa de crecimiento anual.\n</div>\n```\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(tasa_inc_ENOE, aes(x = Fecha, y = Tasa_Anual)) +\n  \n  # 1. Sombreado de área bajo/sobre cero (opcional, pero impactante)\n  # geom_area(aes(y = ifelse(Tasa_Anual > 0, Tasa_Anual, 0)), fill = \"#3D9970\", alpha = 0.1) + # Crecimiento (verde sutil)\n  # geom_area(aes(y = ifelse(Tasa_Anual < 0, Tasa_Anual, 0)), fill = \"#FF4136\", alpha = 0.1) + # Caída (rojo sutil)\n  \n  # 2. Línea Principal: color profesional y grosor adecuado\n  geom_line(color = \"#0072B2\", linewidth = 1.2) + # Azul oscuro (color profesional)\n  \n  # 3. Línea de Cero: más prominente\n  geom_hline(yintercept = 0, color = \"black\", linetype = \"solid\", linewidth = 0.5) +\n  \n  # 4. Etiquetas Estratégicas (Máximo, Mínimo y Último Valor)\n  # Creamos un dataframe para etiquetas clave\n  geom_text(\n    # Filtro que combina la lógica profesional con el requisito de etiquetar TODOS los Q4\n    data = . %>% filter(Trimestre == 4 | # <--- Agregamos este filtro\n                          Tasa_Anual == max(Tasa_Anual, na.rm = TRUE) | \n                          Tasa_Anual == min(Tasa_Anual, na.rm = TRUE) | \n                          Fecha == max(Fecha)),\n    \n    # Mapeo de estéticas\n    aes(label = Tasa_Anual_Etiqueta, \n        vjust = ifelse(Tasa_Anual > 0, -1.2, 1.5)), \n    \n    size = 4,\n    fontface = \"bold\", \n    color = \"#0072B2\"\n  )+\n  \n  # 5. Ejes y Escalas\n  scale_y_continuous(\n    labels = function(x) paste0(x, \"%\"),\n    breaks = scales::pretty_breaks(n = 8) # Control de número de ticks\n  ) +\n  scale_x_date(\n    # Establece las marcas de división principales cada 1 año\n    date_breaks = \"1 year\",\n    # Formatea la etiqueta solo para mostrar el año (ej. 2017)\n    date_labels = \"%Y\"\n  ) +\n  \n  # 6. Títulos y Notas de Fuente\n  labs(\n    title = \"Tasa de Crecimiento Anual del Ingreso Laboral Ponderado\",\n    subtitle = \"Variación Interanual (T/T-4) - Periodo [Año 2015 - Año 2025]\",\n    x = NULL, # Eliminar etiqueta redundante en el eje X\n    y = \"Tasa de Crecimiento (%)\",\n    caption = \"Fuente: INEGI (ENOE), cálculos propios. Notas: [Tasa Anual comparativa T4].\"\n  ) +\n  \n  # 7. Tema Profesional y Limpio\n  theme_minimal() +\n  theme(\n    plot.title = element_text(size = 16, face = \"bold\", hjust = 0), # Título fuerte y alineado a la izquierda\n    plot.subtitle = element_text(size = 12, color = \"gray30\", hjust = 0),\n    plot.caption = element_text(size = 9, color = \"gray50\", hjust = 0), # Fuente en la esquina inferior izquierda\n    axis.title.y = element_text(size = 11, face = \"bold\"),\n    axis.text.x = element_text(angle = 45, hjust = 1, size = 10), # Rotar etiquetas X si el espacio es limitado\n    panel.grid.major.x = element_blank(), # Eliminar líneas de cuadrícula verticales\n    panel.grid.minor = element_blank() # Eliminar líneas secundarias\n  )\n```\n\n::: {.cell-output-display}\n![](Tasa-de-ingresos_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n",
    "supporting": [
      "Tasa-de-ingresos_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}