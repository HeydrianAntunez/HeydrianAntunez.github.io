# 2.1 Crear la columna factorizada
mutate(cs_p13_1_factor = factor(cs_p13_1,
levels = niveles_numericos,
labels = etiquetas_educativas)) %>%
# 2.2 Aplicar el filtro original
filter(!is.na(ingocup),
!is.na(sex))
# 3. Generar el gráfico usando la nueva columna factorizada en facet_wrap
ggplot(data = Enoe_2025_ing_filt_etiquetado,
mapping = aes(x = as.factor(sex), y = ingocup, color = sex)) +
geom_boxplot() +
labs(x = "Sexo",
y = "Ingreso",
title = "Ingreso por Sexo segmentado por Nivel Educativo") +
# Usar la columna factorizada para los paneles
facet_wrap(~cs_p13_1_factor,
labeller = label_value, # Usamos solo el valor de la etiqueta del factor
scales = "free_y") + # Usar "free_y" o "free" si quieres que las escalas se ajusten a cada panel
theme(axis.text.x = element_blank(), # Quitamos las etiquetas redundantes del eje X en cada panel
axis.ticks.x = element_blank())
Enoe_2025_T2$sex<-as.factor(Enoe_2025_ing_filt$sex)
etiquetas_educativas <- c("Ninguna", "Preescolar", "Primaria", "Secundaria",
"Preparatoria", "Normal", "Carrera técnica",
"Profesional", "Maestría", "Doctorado")
niveles_numericos <- 0:9
Enoe_2025_ing_filt<-Enoe_2025_T2%>%
filter(ingocup>0) #Filtramos la base
Enoe_2025_ing_filt_etiquetado <- Enoe_2025_ing_filt %>%
# 2.1 Crear la columna factorizada
mutate(cs_p13_1_factor = factor(cs_p13_1,
levels = niveles_numericos,
labels = etiquetas_educativas)) %>%
# 2.2 Aplicar el filtro original
filter(!is.na(ingocup),
!is.na(sex))
# 3. Generar el gráfico usando la nueva columna factorizada en facet_wrap
ggplot(data = Enoe_2025_ing_filt_etiquetado,
mapping = aes(x = as.factor(sex), y = ingocup, color = sex)) +
geom_boxplot() +
labs(x = "Sexo",
y = "Ingreso",
title = "Ingreso por Sexo segmentado por Nivel Educativo") +
# Usar la columna factorizada para los paneles
facet_wrap(~cs_p13_1_factor,
labeller = label_value, # Usamos solo el valor de la etiqueta del factor
scales = "free_y") + # Usar "free_y" o "free" si quieres que las escalas se ajusten a cada panel
theme(axis.text.x = element_blank(), # Quitamos las etiquetas redundantes del eje X en cada panel
axis.ticks.x = element_blank())
#| message: false
#| warning: false
library(dplyr)
library(ggplot2)
library(survey)
diseno<-svydesign(id=~upm, strata=~est, data=Enoe_2025_T2,
weights=~fac_tri)
#Como primer paso creamos un filtro para analizar sólo aquellas observaciones que tengan un ingreso>0
diseño_ingresos_filt<-subset(diseno, ingocup >0)
```{r}
modelo1<-svyglm(ingocup~sex+ eda, design = diseño_ingresos_filt) #Establecemos un regresión lineal ponderada entre ingreso, sexo y edad.
summary(modelo1)
modelo2<- svyglm(ingocup~sex+ eda+ as.factor(cs_p13_1), design= diseño_ingresos_filt)
summary(modelo2)
modelo3<-svyglm(ingocup~sex*eda+as.factor(cs_p13_1), design = diseño_ingresos_filt)
summary(modelo3)
#| message: false
#| warning: false
library(ggeffects)
# Se fija la escolaridad (cs_p13_1) en un nivel, por ejemplo, el Nivel 7.
predicciones_interaccion <- ggpredict(
model = modelo3,
terms = c("eda [all]", "sex", "cs_p13_1 [7]")
)
#creamos el gráfico
#Elgráfrico muestra la diferencia de ingresos para las diferentes edad agrupadas por sexo, manteniendo la escolaridad constante en 7(licenciatura)
library(scales)
grafico_interaccion <- plot(predicciones_interaccion) +
labs(
# Título que resalta la diferencia (hallazgo clave)
title = "Ingresos por Edad: Brecha Salarial según sexo",
# Subtítulo para añadir el contexto de la escolaridad (profesionaliza el gráfico)
subtitle = "Efecto modelado para el Nivel de Escolaridad 7 (Profesional)",
x = "Edad (años)",
# Eje Y más específico
y = "Ingreso (Pesos MXN)",
color = "Sexo"
) +
theme_minimal() +
# **Nueva capa para formato de eje Y**
scale_y_continuous(labels = label_number(big.mark = ",", prefix = "$")) +
scale_color_manual(
values = c("1" = "#E41A1C", "2" = "#377EB8"),
labels = c("1" = "Hombre", "2" = "Mujer")
)
print(grafico_interaccion)
gráfico_interacciion1|gráfico_interacciion2
gráfico_interaccion1|gráfico_interacciion2
grafico_interaccion1|grafico_interacciion2
grafico_interaccion1|grafico_interaccion2
#| message: false
#| warning: false
library(ggeffects)
# Se fija la escolaridad (cs_p13_1) en un nivel, por ejemplo, el Nivel 7.
predicciones_interaccion <- ggpredict(
model = modelo3,
terms = c("eda [all]", "sex", "cs_p13_1 [7]")
)
#creamos el gráfico
#Elgráfrico muestra la diferencia de ingresos para las diferentes edad agrupadas por sexo, manteniendo la escolaridad constante en 7(licenciatura)
library(scales)
#Para gente con estudios profesionales
grafico_interaccion1 <- plot(predicciones_interaccion) +
labs(
# Título que resalta la diferencia (hallazgo clave)
title = "Ingresos por Edad: Brecha Salarial según sexo",
# Subtítulo para añadir el contexto de la escolaridad (profesionaliza el gráfico)
subtitle = "Efecto modelado para el Nivel de Escolaridad 7 (Profesional)",
x = "Edad (años)",
# Eje Y más específico
y = "Ingreso (Pesos MXN)",
color = "Sexo"
) +
theme_minimal() +
# **Nueva capa para formato de eje Y**
scale_y_continuous(labels = label_number(big.mark = ",", prefix = "$")) +
scale_color_manual(
values = c("1" = "#E41A1C", "2" = "#377EB8"),
labels = c("1" = "Hombre", "2" = "Mujer")
)
#Para gente con educación bachiller
grafico_interaccion2 <- plot(predicciones_interaccion) +
labs(
# Título que resalta la diferencia (hallazgo clave)
title = "Ingresos por Edad: Brecha Salarial según sexo",
# Subtítulo para añadir el contexto de la escolaridad (profesionaliza el gráfico)
subtitle = "Efecto modelado para el Nivel de Escolaridad 7 (Profesional)",
x = "Edad (años)",
# Eje Y más específico
y = "Ingreso (Pesos MXN)",
color = "Sexo"
) +
theme_minimal() +
# **Nueva capa para formato de eje Y**
scale_y_continuous(labels = label_number(big.mark = ",", prefix = "$")) +
scale_color_manual(
values = c("1" = "purple", "2" = "gold"),
labels = c("1" = "Hombre", "2" = "Mujer")
)
grafico_interaccion1|grafico_interaccion2
library(patchwork)
#| message: false
#| warning: false
library(ggeffects)
# Se fija la escolaridad (cs_p13_1) en un nivel, por ejemplo, el Nivel 7.
predicciones_interaccion <- ggpredict(
model = modelo3,
terms = c("eda [all]", "sex", "cs_p13_1 [7]")
)
#creamos el gráfico
#Elgráfrico muestra la diferencia de ingresos para las diferentes edad agrupadas por sexo, manteniendo la escolaridad constante en 7(licenciatura)
library(scales)
library(patchwork)
#Para gente con estudios profesionales
grafico_interaccion1 <- plot(predicciones_interaccion) +
labs(
# Título que resalta la diferencia (hallazgo clave)
title = "Ingresos por Edad: Brecha Salarial según sexo",
# Subtítulo para añadir el contexto de la escolaridad (profesionaliza el gráfico)
subtitle = "Efecto modelado para el Nivel de Escolaridad 7 (Profesional)",
x = "Edad (años)",
# Eje Y más específico
y = "Ingreso (Pesos MXN)",
color = "Sexo"
) +
theme_minimal() +
# **Nueva capa para formato de eje Y**
scale_y_continuous(labels = label_number(big.mark = ",", prefix = "$")) +
scale_color_manual(
values = c("1" = "#E41A1C", "2" = "#377EB8"),
labels = c("1" = "Hombre", "2" = "Mujer")
)
#Para gente con educación bachiller
grafico_interaccion2 <- plot(predicciones_interaccion) +
labs(
# Título que resalta la diferencia (hallazgo clave)
title = "Ingresos por Edad: Brecha Salarial según sexo",
# Subtítulo para añadir el contexto de la escolaridad (profesionaliza el gráfico)
subtitle = "Efecto modelado para el Nivel de Escolaridad 7 (Profesional)",
x = "Edad (años)",
# Eje Y más específico
y = "Ingreso (Pesos MXN)",
color = "Sexo"
) +
theme_minimal() +
# **Nueva capa para formato de eje Y**
scale_y_continuous(labels = label_number(big.mark = ",", prefix = "$")) +
scale_color_manual(
values = c("1" = "purple", "2" = "gold"),
labels = c("1" = "Hombre", "2" = "Mujer")
)
grafico_interaccion1|grafico_interaccion2
#| message: false
#| warning: false
library(ggeffects)
#creamos el gráfico
#Elgráfrico muestra la diferencia de ingresos para las diferentes edad agrupadas por sexo, manteniendo la escolaridad constante en 7(licenciatura)
library(scales)
library(patchwork)
#Para gente con estudios profesionales
# Se fija la escolaridad (cs_p13_1) en un nivel, por ejemplo, el Nivel 7.
predicciones_interaccion1 <- ggpredict(
model = modelo3,
terms = c("eda [all]", "sex", "cs_p13_1 [7]")
)
grafico_interaccion1 <- plot(predicciones_interaccion1) +
labs(
# Título que resalta la diferencia (hallazgo clave)
title = "Ingresos por Edad y sexo",
# Subtítulo para añadir el contexto de la escolaridad (profesionaliza el gráfico)
subtitle = "Nivel de Escolaridad 7 (Profesional)",
x = "Edad (años)",
# Eje Y más específico
y = "Ingreso (Pesos MXN)",
color = "Sexo"
) +
theme_minimal() +
# **Nueva capa para formato de eje Y**
scale_y_continuous(labels = label_number(big.mark = ",", prefix = "$")) +
scale_color_manual(
values = c("1" = "#E41A1C", "2" = "#377EB8"),
labels = c("1" = "Hombre", "2" = "Mujer")
)
#Para gente con educación bachiller
# Se fija la escolaridad (cs_p13_1) en un nivel 4.
predicciones_interaccion2 <- ggpredict(
model = modelo3,
terms = c("eda [all]", "sex", "cs_p13_1 [4]")
)
grafico_interaccion2 <- plot(predicciones_interaccion2) +
labs(
# Título que resalta la diferencia (hallazgo clave)
title = "Ingresos por Edad y sexo",
# Subtítulo para añadir el contexto de la escolaridad (profesionaliza el gráfico)
subtitle = " Nivel de Escolaridad 4 (bachillerato)",
x = "Edad (años)",
# Eje Y más específico
y = "Ingreso (Pesos MXN)",
color = "Sexo"
) +
theme_minimal() +
# **Nueva capa para formato de eje Y**
scale_y_continuous(labels = label_number(big.mark = ",", prefix = "$")) +
scale_color_manual(
values = c("1" = "purple", "2" = "gold"),
labels = c("1" = "Hombre", "2" = "Mujer")
)
grafico_interaccion1|grafico_interaccion2
#| message: false
#| warning: false
library(foreign)
library(dplyr)
library(ggplot2)
library(survey)
library(scales)
library(scales)
ggplot(Enoe_2025_ing_filt, aes(x=eda, y= ingocup, size= fac_tri, color=sex)) +
geom_jitter(width = 0.3, height = 0) +
guides(size="none") +
scale_y_continuous(labels = label_number(big.mark = ",", decimal.mark = ".")) +
labs(y="Ingreso Ocupacional",
x="Edad (eda)",
title="Ingreso Ocupacional vs. Edad, por Sexo")
#| message: false
#| warning: false
library(foreign)
library(dplyr)
library(ggplot2)
library(survey)
library(scales)
#| message: false
#| warning: false
Enoe_2025_T2<-read.csv("C:/Users/USER/Downloads/Bases de datos/INEGI/ENOE SDME 2015 a 2025/conjunto_de_datos_sdem_enoe_2025_2t.csv")
#| message: false
#| warning: false
ggplot(Enoe_2025_T2, aes(x=fac_tri))+
geom_histogram()+
facet_wrap(~est)
#Observamos el tamaño de los cluster.
#| message: false
#| warning: false
Enoe_2025_T2%>%
summarize(n_clusters=n_distinct(est, upm))
#Para ver en detalle la composición de los clusters correr el código:
#Enoe_2025_T2%>%
#count(est, upm)
diseno<-svydesign(id=~upm, strata=~est, data=Enoe_2025_T2,
weights=~fac_tri)
diseno<-svydesign(id=~upm, strata=~est, data=Enoe_2025_T2,
weights=~fac_tri)
#No ponderado
sex<-Enoe_2025_T2%>%
group_by(sex)%>%
summarize(Freq= n())%>%  #Contamos el la frecuencia agrupada por sexo
mutate(Prop=round(Freq*100/sum(Freq), 1))%>% #Calculamos la proporción para cada grupo de sexo
arrange(desc(Prop)) #Ordenamos de forma descendente
sex
#Ponderado
sex_fac<-svytable(~sex, design=diseno)%>%  #Creamos una tabla a partir de los datos del diseño muestral
as.data.frame()%>% #Convertimos la data del diseño a un data frame
mutate(Prop=round(Freq*100/sum(Freq), 1))%>%
arrange(desc(Prop))
sex_fac
#No ponderado
edu<-Enoe_2025_T2%>%
group_by(cs_p13_1)%>%
summarize(Freq=n())%>%
mutate(Prop=round(Freq*100/sum(Freq), 1))
edu
#Ponderado
educa_fac<-svytable(~cs_p13_1, design = diseno)%>%
as.data.frame()%>%
mutate(Prop_ponderada=round(Freq*100/sum(Freq), 1))
educa_fac
#| message: false
#| warning: false
#Gráfica con datos de educación no ponederados
ggplot(data = edu[edu$cs_p13_1 < 10, ],
aes(x = factor(cs_p13_1), y = Prop)) +
geom_col(fill = "lightblue") +
scale_x_discrete(labels = c("Ninguna", "Preescolar", "Primaria", "Secundaria",
"Preparatoria", "Normal", "Carrera técnica",
"Profesional", "Maestría", "Doctorado")) +
theme(axis.text = element_text(size = 10, angle = 45),
legend.position = "none") +
geom_text(aes(label = paste0(Freq, " ", "", "\n(", Prop, "%)"))) +
labs(title = "Niveles de educación: Frecuencia y proporción no ponderadas",
x = "Nivel de educación", y = "Proporción")
#Gráfica con datos ponderados
ggplot(data = educa_fac, aes(x=cs_p13_1, y= Prop_ponderada))+
geom_col(fill="darkred")+
scale_x_discrete(limits=edu[edu$cs_p13_1 < 10,]$cs_p13_1, labels=c("Ninguna","Preescolar","Primaria", "Secundaria",
"Preparatoria",
"Normal", "Carrera técnica",
"Profesional",
"Maestría","Doctorado","No sabe"))+
theme(axis.text = element_text(size=10, angle=45),legend.position =
"none")+
geom_text(aes(label=paste0(Freq, " ", "", "\n(", Prop_ponderada, "%",")")))+
labs(title="Niveles de educación: Frecuencia y proporción ponderadas", x="Nivel
de educación",y="Proporción")
#Data no ponderada
Enoe_2025_T2%>%
group_by(sex, cs_p13_1)%>%
summarise(Freq= n())
#Data ponderada con diseño muestral
educa_sex<- svytable(~cs_p13_1+ sex, design = diseno)
educa_sex
#Lo convertimos a un dataframe
educa_sex<- as.data.frame(educa_sex)
educa_sex
prop_edu_sex<- educa_sex%>%
as.data.frame()%>%
group_by(sex)%>%
mutate(n_sex=sum(Freq), Prop_educa=Freq/sum(Freq))%>%
ungroup
prop_edu_sex
ggplot(data= prop_edu_sex, aes(x= sex, fill = cs_p13_1, y= Prop_educa))+
geom_col()+
scale_fill_discrete(labels =c("Ninguna","Preescolar","Primaria", "Secundaria",
"Preparatoria",
"Normal", "Carrera técnica",
"Profesional",
"Maestría","Doctorado","No sabe"))+
guides(fill=guide_legend(title="Nivel"))+
scale_x_discrete( labels=c("Hombres", "Mujeres"))+
theme(axis.text = element_text(size=10, angle=45),legend.position =
"right")+
labs(title="Nivel de educación del jefe de familia por sexo",
x="Sexo",y="Proporción")
#| message: false
#| warning: false
ggplot(data=prop_edu_sex, aes(x=cs_p13_1, fill = sex, y= Freq))+
geom_col(position = "dodge")+   #Colocamos columnas separadas.
geom_text(
aes(label = scales::label_percent(accuracy = 0.01)(Prop_educa)), # 2. Usar label_percent
position = position_dodge(width = 0.9),
vjust = -0.5,
size = 2 # Aumenté un poco el tamaño de la fuente para mejor legibilidad
) +
scale_y_continuous(labels = scales::label_number(big.mark = ",", decimal.mark = "."))+
scale_fill_discrete(labels=c("Hombres","Mujeres"))+  #Colocamos etiquetas para la variable sexo.
guides(fill=guide_legend(title = "Sexo"))+
scale_x_discrete(limits=educa_sex$cs_p13_1, labels=c("Ninguna","Preescolar","Primaria", "Secundaria","Preparatoria","Normal", "Carrera técnica","Profesional","Maestría","Doctorado","No sabe"))+
theme(axis.text = element_text(size= 10, angle=45), legend.position ="right")+
labs(tittle="Nivel de educacion del jefe de familia", x="Nivel educativo", y= "Total de personas")
svychisq(~cs_p13_1+sex, design = diseno, static="Chisq") #Prueba de independencia Chi-cuadrada de pearson
#Como primer paso creamos un filtro para analizar sólo aquellas observaciones que tengan un ingreso>0
diseño_ingresos_filt<-subset(diseno, ingocup >0)
#Calculamos la media bajo el diseño muestras complejas. Esto permite observar los errores estándar para el cálculo de las estimaciones.
svymean(~ingocup, design= diseño_ingresos_filt, na.rm= T)
#Calculamos los cuartiles
svyquantile(~ingocup, design= diseño_ingresos_filt, na.rm= T, quantile=c(0.01,.25,.5,.75,.9))
svyby(~ingocup, design= diseño_ingresos_filt, na.rm=T, by = ~sex, FUN=svymean, row.names=F)
Enoe_2025_T2%>%
filter(ingocup>0)%>%
group_by(sex)%>%
summarize(Frecuencia=n(), Ingreso_medio=mean(ingocup), se=sd(ingocup)/sqrt(Frecuencia))
#Ponderado
svyby(~ingocup, design = diseño_ingresos_filt, na.rm=T, by = ~cs_p13_1, FUN= svymean, row.names= F)
#Sin ponderar
Enoe_2025_T2%>%
filter(ingocup>0)%>%
group_by(cs_p13_1)%>%
summarize(Frecuencia= n(), Ingreso_medio=mean(ingocup), se=sd(ingocup)/sqrt(Frecuencia))
#Primero aplicamos el diseño muestral a nuestra tabla para obtener el cuartil .50 (mediana)
tabla<-svyby(formula = ~ingocup, by= ~ cs_p13_1+sex, design= diseño_ingresos_filt, FUN = svyquantile, quantiles=0.5, row.names=F, na.rm=T,
keep.names = F)
#Añadimos a la tabla el error estándar
tabla<- mutate(tabla, lower=ingocup-se.ingocup, upper=ingocup+se.ingocup)
tabla
tabla$sex <- as.factor(tabla$sex)
ggplot(tabla, aes(x = factor(cs_p13_1), y = ingocup, color = sex)) +
geom_point(size = 4,
position = position_dodge(width = 0.7)) +
scale_y_continuous(labels = label_dollar(prefix = "$")) +
scale_x_discrete(labels = c("Ninguna","Preescolar","Primaria", "Secundaria","Preparatoria","Normal", "Carrera técnica","Profesional","Maestría","Doctorado","No sabe")) +
geom_text(
aes(label = label_dollar(prefix = "$")(ingocup),
group = sex),
vjust = -2.5,
position = position_dodge(width = 0.7),
size = 2
) +
scale_color_manual(values = c("1" = "#0072B2", "2" = "#D55E00"),
labels = c("Hombres", "Mujeres")) +
theme_minimal() +
labs(title = "Medianas de los ingresos por nivel educativo y sexo",
x = "Nivel Educativo",
y = "Ingreso Promedio ($)",
color = "Sexo",
caption= "Fuente:Encuesta Nacional de Ocupación y Empleo, INEGI") +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
plot.title = element_text(face = "bold"),
plot.caption = element_text(hjust = 1.5)
)
N=500
N<-500
set.seed(42)
horas_estudio <- rnorm(N, mean = 12, sd = 4)
# Limitar entre 1 y 25 horas y redondear a un decimal
horas_estudio <- pmin(pmax(horas_estudio, 1), 25)
horas_estudio <- round(horas_estudio, 1)
asistencia <- round(asistencia, 2)
asistencia <- runif(N, min = 0.5, max = 1.0)
asistencia <- round(asistencia, 2)
clases_particulares <- rbinom(N, size = 1, prob = 0.30)
# Convertir a Factor para que R lo trate como variable categórica en el modelo
clases_particulares <- factor(clases_particulares,
levels = c(0, 1),
labels = c("No", "Si"))
B0 <- 30
B1 <- 3.5
B2 <- 25
B3_dummy <- 10
error <- rnorm(N, mean = 0, sd = 8)
X3_efecto <- ifelse(clases_particulares == "Si", B3_dummy, 0)
calificacion_final <- (B0 +
B1 * horas_estudio +
B2 * asistencia +
X3_efecto +
error)
calificacion_final
calificacion_final
calificacion_final <- pmin(pmax(calificacion_final, 0), 100)
calificacion_final <- round(calificacion_final, 0)
calificacion_final
student_performance_df <- data.frame(
Horas_Estudio = horas_estudio,
Asistencia_Clases = asistencia,
Clases_Particulares = clases_particulares,
Calificacion_Final = calificacion_final
)
student_performance_df
View(student_performance_df)
print(str(student_performance_df))
#Aplcaimos el modelo de regresion
modelo<- lm(calificacion_final~ Horas_Estudio + Asistencia_Clases + Clases_Particulares,
data= student_performance_df)
modelo
summary(modelo)
par(mfrow = c(2, 2)) # Configura la ventana gráfica para mostrar 4 gráficos
plot(modelo)
library(effects)
library(ggplot2)
install.packages("effects")
library(effects)
library(ggplot2)
# Gráfico del efecto de Horas de Estudio
plot(effect("Horas_Estudio", modelo_regresion))
# Gráfico del efecto de Horas de Estudio
plot(effect("Horas_Estudio", modelo))
# Gráfico del efecto de Asistencia a Clases
plot(effect("Asistencia_Clases", modelo))
plot(effect("Clases_Particulares", modelo))
modelo_con_interaccion <- lm(Calificacion_Final ~ Horas_Estudio * Clases_Particulares + Asistencia_Clases,
data = student_performance_df)
modelo_con_interaccion
plot(effect("Horas_Estudio:Clases_Particulares", modelo_interactivo))
plot(effect("Horas_Estudio:Clases_Particulares", modelo))
modelo_interactivo <- lm(Calificacion_Final ~ Horas_Estudio * Clases_Particulares + Asistencia_Clases,
data = student_performance_df)
plot(effect("Horas_Estudio:Clases_Particulares", modelo_interactivo))
