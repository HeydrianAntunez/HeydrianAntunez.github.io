cat(paste("   * AVISO: Columna 'EST' renombrada a 'est' en", nombre_df, "\n"))
}
# 3. Corrección: Variable de Ingreso (ingocup / inglab / INGOCUP)
if (!("ingocup" %in% names(df_actual))) {
if ("inglab" %in% names(df_actual)) {
df_actual <- df_actual %>% rename(ingocup = inglab)
} else if ("INGOCUP" %in% names(df_actual)) {
df_actual <- df_actual %>% rename(ingocup = INGOCUP)
}
}
# 4. Corrección: Factor de Ponderación (FAC / FAC_TRI) a minúsculas
if (!(peso_actual_str %in% names(df_actual)) && (peso_antiguo_str %in% names(df_actual))) {
# Usamos := y !!sym() para renombrar la variable de texto
df_actual <- df_actual %>% rename(!!sym(peso_actual_str) := !!sym(peso_antiguo_str))
}
# =======================================================
# A. Filtrado y Preparación
df_filt <- df_actual %>%
filter(ingocup > 0, !is.na(ingocup))
# B. Diseño Muestral y Ponderación
formula_peso <- as.formula(paste0("~", peso_actual_str))
diseno_actual <- svydesign(
ids = ~upm,
strata = ~est, # Ahora 'est' existe
data = df_filt,
weights = formula_peso,
nest = TRUE
)
# C. Cálculo de Media e IC
media_ponderada <- svymean(~ingocup, diseno_actual, na.rm = TRUE)
ic_95 <- confint(media_ponderada)
# D. Almacenar resultados
tabla_temp <- data.frame(
Año = año,
Trimestre = trimestre,
Media = as.numeric(media_ponderada[1]),
IC_Inferior = as.numeric(ic_95[1]),
IC_Superior = as.numeric(ic_95[2])
)
# E. Consolidar
serie_ingreso_total <- bind_rows(serie_ingreso_total, tabla_temp)
cat(paste("✅ Éxito:", nombre_df, "procesado usando peso:", peso_actual_str, "\n"))
}, error = function(e) {
cat(paste("⚠️ Omitido:", nombre_df, "– Error:", conditionMessage(e), "\n"))
})
}
}
ruta<- "C:/Users/USER/Downloads/Bases de datos/INEGI/ENOE SDME 2015 a 2025/conjunto_de_datos_sdem_enoe_"
años<- 2015:2025
trimestres<-1:4
for (año in años) {
for (trimestre in trimestres) {
nombre_archivo <- paste0(ruta, año, "_", trimestre, "t.csv")
nombre_variable <- paste0("Enoe_", año, "_T", trimestre)
# Intenta leer el archivo y asignarlo
tryCatch({
assign(nombre_variable, read.csv(nombre_archivo))
cat("✅ Éxito al cargar:", nombre_variable, "\n")
}, error = function(e) {
# Si ocurre un error (como que el archivo no existe), ejecuta esto
cat("⚠️ AVISO: No se pudo cargar el archivo:", nombre_archivo, "\n")
# Puedes añadir una condición específica si es el 2020 T2 para un mensaje claro
if (año == 2020 & trimestre == 2) {
cat("   * Razón: Archivo omitido intencionalmente (encuesta no realizada en T2 2020).", "\n")
} else {
cat("   * Mensaje de error:", conditionMessage(e), "\n")
}
cat("\n") # Salto de línea para separar las iteraciones
})
# El bucle sigue automáticamente con la siguiente iteración sin detenerse
}
}
library(dplyr)
library(survey)
Enoe_2015_T1_filt<-Enoe_2015_T1%>%
filter(ingocup>0)
# Cargar librerías necesarias
library(dplyr)
library(survey)
library(ggplot2) # Para la visualización
# 1. Definir los parámetros de la serie
años <- 2015:2025
trimestres <- 1:4
# 2. Inicializar el data frame de resultados
serie_ingreso_total <- data.frame()
for (año in años) {
for (trimestre in trimestres) {
nombre_df <- paste0("Enoe_", año, "_T", trimestre)
# --- Ajuste Condicional del Factor de Peso ---
if (año > 2020 | (año == 2020 & trimestre >= 2)) {
peso_actual_str <- "fac_tri"
peso_antiguo_str <- "FAC_TRI"
} else {
peso_actual_str <- "fac"
peso_antiguo_str <- "FAC"
}
# ---------------------------------------------
tryCatch({
df_actual <- get(nombre_df)
# =======================================================
# ✨ PASO CLAVE 1: ESTANDARIZAR NOMBRES DE COLUMNAS ✨
# =======================================================
# 1. Corrección: UPM (mayúsculas) a upm (minúsculas)
if (!("upm" %in% names(df_actual)) && ("UPM" %in% names(df_actual))) {
df_actual <- df_actual %>% rename(upm = UPM)
}
# 2. ✨ NUEVA CORRECCIÓN: EST (mayúsculas) a est (minúsculas)
if (!("est" %in% names(df_actual)) && ("EST" %in% names(df_actual))) {
df_actual <- df_actual %>% rename(est = EST)
cat(paste("   * AVISO: Columna 'EST' renombrada a 'est' en", nombre_df, "\n"))
}
# 3. Corrección: Variable de Ingreso (ingocup / inglab / INGOCUP)
if (!("ingocup" %in% names(df_actual))) {
if ("inglab" %in% names(df_actual)) {
df_actual <- df_actual %>% rename(ingocup = inglab)
} else if ("INGOCUP" %in% names(df_actual)) {
df_actual <- df_actual %>% rename(ingocup = INGOCUP)
}
}
# 4. Corrección: Factor de Ponderación (FAC / FAC_TRI) a minúsculas
if (!(peso_actual_str %in% names(df_actual)) && (peso_antiguo_str %in% names(df_actual))) {
# Usamos := y !!sym() para renombrar la variable de texto
df_actual <- df_actual %>% rename(!!sym(peso_actual_str) := !!sym(peso_antiguo_str))
}
# =======================================================
# A. Filtrado y Preparación
df_filt <- df_actual %>%
filter(ingocup > 0, !is.na(ingocup))
# B. Diseño Muestral y Ponderación
formula_peso <- as.formula(paste0("~", peso_actual_str))
diseno_actual <- svydesign(
ids = ~upm,
strata = ~est, # Ahora 'est' existe
data = df_filt,
weights = formula_peso,
nest = TRUE
)
# C. Cálculo de Media e IC
media_ponderada <- svymean(~ingocup, diseno_actual, na.rm = TRUE)
ic_95 <- confint(media_ponderada)
# D. Almacenar resultados
tabla_temp <- data.frame(
Año = año,
Trimestre = trimestre,
Media = as.numeric(media_ponderada[1]),
IC_Inferior = as.numeric(ic_95[1]),
IC_Superior = as.numeric(ic_95[2])
)
# E. Consolidar
serie_ingreso_total <- bind_rows(serie_ingreso_total, tabla_temp)
cat(paste("✅ Éxito:", nombre_df, "procesado usando peso:", peso_actual_str, "\n"))
}, error = function(e) {
cat(paste("⚠️ Omitido:", nombre_df, "– Error:", conditionMessage(e), "\n"))
})
}
}
View(tabla_temp)
View(serie_ingreso_total)
serie_ENOE15_25<-serie_ingreso_total%>%
mutate(
Fecha=as.Date(paste(Año, Trimestre *3-2, 1, sep = "-"), format="%Y-%m-%d")
)
serie_ENOE15_25
View(serie_ENOE15_25)
serie_tiempo_enoe<-ggplot(serie_ENOE15_25, aes(x=Fecha,  y= Media))+
geom_ribbon(
aes(ymin= IC_Inferior, ymax=IC_Superior),
fill="#0072B2",
alpha = 0.2,
)+
geom_line(color="#0072B2", size = 1) +
labs(
title = "Evolución del Ingreso Laboral Promedio Ponderado (ENOE)",
subtitle = "Media con Intervalo de Confianza del 95%",
x = "Trimestre",
y = "Ingreso Promedio Ponderado (MXN)"
) +
theme_minimal() +
scale_y_continuous(labels = scales::comma) # Formato de miles para el eje Y
serie_tiempo_enoe
serie_tiempo_enoe<-ggplot(serie_ENOE15_25, aes(x=Fecha,  y= Media))+
geom_ribbon(
aes(ymin= IC_Inferior, ymax=IC_Superior),
fill="#0072B2",
alpha = 0.2,
)+
geom_line(color="#0072B2", size = 1) +
labs(
title = "Evolución del Ingreso Laboral Promedio Ponderado (ENOE)",
subtitle = "Media con Intervalo de Confianza del 95%",
x = "Trimestre",
y = "Ingreso Promedio Ponderado (MXN)",
caption = "Fuente: Elaboración propia a partir de INEGI ENOE 2015 al 2025"
) +
theme_minimal() +
scale_y_continuous(labels = scales::comma) # Formato de miles para el eje Y
serie_tiempo_enoe
serie_ENOE15_25<-serie_ingreso_total%>%
mutate(
Fecha=as.Date(paste(Año, Trimestre *3-2, 1, sep = "-"), format="%Y-%m-%d"),
Etiqueta_Media = format(round(Media, 2), big.mark = ",", decimal.mark = ".", scientific = FALSE)
) %>%
arrange(Fecha)
serie_ENOE15_25
serie_tiempo_enoe<-ggplot(serie_ENOE15_25, aes(x=Fecha,  y= Media))+
geom_ribbon(
aes(ymin= IC_Inferior, ymax=IC_Superior),
fill="#0072B2",
alpha = 0.2,
)+
geom_line(color="#0072B2", size = 1) +
geom_text(
# Muestra la etiqueta solo si es el primer trimestre del año (o el único visible)
data = subset(serie_ingreso_final, Trimestre == 1 | Fecha == max(Fecha)),
aes(label = Etiqueta_Media),
vjust = -1, # Posiciona la etiqueta ligeramente por encima del punto
size = 3.5,
color = "black"
) +
# D. Ajustar el Eje X para mostrar los extremos
scale_x_date(
breaks = "1 year", # Marcas principales cada año
date_labels = "%Y", # Formato de la etiqueta: solo el año (ej. 2015)
limits = as.Date(c("2014-12-01", "2026-03-01")) # **LÍMITES AMPLIADOS**
) +
labs(
title = "Evolución del Ingreso Laboral Promedio Ponderado (ENOE)",
subtitle = "Media con Intervalo de Confianza del 95%",
x = "Trimestre",
y = "Ingreso Promedio Ponderado (MXN)",
caption = "Fuente: Elaboración propia a partir de INEGI ENOE 2015 al 2025"
) +
theme_minimal() +
scale_y_continuous(labels = scales::comma) # Formato de miles para el eje Y
serie_tiempo_enoe<-ggplot(serie_ENOE15_25, aes(x=Fecha,  y= Media))+
geom_ribbon(
aes(ymin= IC_Inferior, ymax=IC_Superior),
fill="#0072B2",
alpha = 0.2,
)+
geom_line(color="#0072B2", size = 1) +
geom_text(
# Muestra la etiqueta solo si es el primer trimestre del año (o el único visible)
data = subset(serie_ENOE15_25, Trimestre == 1 | Fecha == max(Fecha)),
aes(label = Etiqueta_Media),
vjust = -1, # Posiciona la etiqueta ligeramente por encima del punto
size = 3.5,
color = "black"
) +
# D. Ajustar el Eje X para mostrar los extremos
scale_x_date(
breaks = "1 year", # Marcas principales cada año
date_labels = "%Y", # Formato de la etiqueta: solo el año (ej. 2015)
limits = as.Date(c("2014-12-01", "2026-03-01")) # **LÍMITES AMPLIADOS**
) +
labs(
title = "Evolución del Ingreso Laboral Promedio Ponderado (ENOE)",
subtitle = "Media con Intervalo de Confianza del 95%",
x = "Trimestre",
y = "Ingreso Promedio Ponderado (MXN)",
caption = "Fuente: Elaboración propia a partir de INEGI ENOE 2015 al 2025"
) +
theme_minimal() +
scale_y_continuous(labels = scales::comma) # Formato de miles para el eje Y
serie_tiempo_enoe
View(serie_ENOE15_25)
tasa_inc_ENOE<-serie_ENOE15_25%>%
arrange(Fecha)%>% # Asegurarse de que esté ordenada cronológicamente
mutate(
Media_Anterior = lag(Media, n = 1),
# 2. Calcular la Tasa de Variación Trimestral (TVT)
Tasa_Trimestral = ((Media - Media_Anterior) / Media_Anterior) * 100,
# Formato para la visualización
Tasa_Trimestral_Etiqueta = paste0(round(Tasa_Trimestral, 2), "%")
)
tasa_inc_ENOE
View(tasa_inc_ENOE)
#Calculamos la tasa de variación anual
tasa_inc_ENOE<-tasa_inc_ENOE%>%
mutate(
# 1. Obtener la media del mismo trimestre del año anterior (t-4)
Media_Anual_Anterior = lag(Media, n = 4),
# 2. Calcular la Tasa de Variación Anual (TVA)
Tasa_Anual = ((Media - Media_Anual_Anterior) / Media_Anual_Anterior) * 100,
# Formato para la visualización
Tasa_Anual_Etiqueta = paste0(round(Tasa_Anual, 2), "%")
)
tasa_inc_ENOE
View(serie_ingreso_total)
View(tasa_inc_ENOE)
ggplot(tasa_inc_ENOE, aes(x = Fecha, y = Tasa_Anual)) +
geom_line(color = "darkred", size = 1) +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") + # Línea de referencia en 0%
# Añadir etiquetas solo al final de cada año para no saturar
geom_text(
data = subset(tasa_ingreso, Trimestre == 4 | Fecha == max(Fecha)),
aes(label = Tasa_Anual_Etiqueta),
vjust = -0.5,
size = 3.5,
color = "darkred"
) +
labs(
title = "Tasa de Crecimiento Anual del Ingreso Laboral Ponderado (ENOE)",
subtitle = "Variación Interanual (T/T-4)",
x = "Fecha",
y = "Tasa de Crecimiento (%)"
) +
theme_minimal() +
scale_y_continuous(labels = function(x) paste0(x, "%"))
ggplot(tasa_inc_ENOE, aes(x = Fecha, y = Tasa_Anual)) +
geom_line(color = "darkred", size = 1) +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") + # Línea de referencia en 0%
# Añadir etiquetas solo al final de cada año para no saturar
geom_text(
data = subset(tasa_inc_ENOE, Trimestre == 4 | Fecha == max(Fecha)),
aes(label = Tasa_Anual_Etiqueta),
vjust = -0.5,
size = 3.5,
color = "darkred"
) +
labs(
title = "Tasa de Crecimiento Anual del Ingreso Laboral Ponderado (ENOE)",
subtitle = "Variación Interanual (T/T-4)",
x = "Fecha",
y = "Tasa de Crecimiento (%)"
) +
theme_minimal() +
scale_y_continuous(labels = function(x) paste0(x, "%"))
picos_bajos <- tasa_inc_ENOE %>%
# Ordenar el data frame por Tasa_Anual de forma ascendente
arrange(Tasa_Anual) %>%
# Seleccionar las 5 filas superiores (las caídas más grandes)
head(5) %>%
# Seleccionar solo las columnas clave para el reporte
select(Año, Trimestre, Fecha, Media, Tasa_Anual, Tasa_Anual_Etiqueta)
picos_bajos
#GRaficamos con los picos más bajos de incremento
ggplot(tasa_inc_ENOE, aes(x = Fecha, y = Tasa_Anual)) +
# Dibujar la línea
geom_line(color = "gray", size = 1) +
# Añadir puntos con color condicional
geom_point(aes(color = Tasa_Anual < 0), size = 2) +
scale_color_manual(values = c("TRUE" = "darkred", "FALSE" = "#0072B2")) + # Rojo para crecimiento negativo
# Opcional: etiquetar solo el mínimo global
geom_text(
data = subset(tasa_inc_ENOE, Tasa_Anual == min(tasa_inc_ENOE$Tasa_Anual, na.rm = TRUE)),
aes(label = Tasa_Anual_Etiqueta),
vjust = 2,
color = "darkred",
size = 4
) +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
theme_minimal() +
theme(legend.position = "none") # Quitar la leyenda de color
tasa_inc_enoe <- tasa_inc_enoe %>%
mutate(
# Crear una etiqueta de texto para la gráfica (con signo %)
Tasa_Anual_Etiqueta = paste0(round(Tasa_Anual, 2), "%"),
# Crear la variable condicional para el color
Crecimiento_Negativo = Tasa_Anual < 0
)
tasa_inc_ENOE <- tasa_inc_ENOE %>%
mutate(
# Crear una etiqueta de texto para la gráfica (con signo %)
Tasa_Anual_Etiqueta = paste0(round(Tasa_Anual, 2), "%"),
# Crear la variable condicional para el color
Crecimiento_Negativo = Tasa_Anual < 0
)
tasa_inc_ENOE
View(tasa_inc_ENOE)
colores_crecimiento <- c("TRUE" = "darkred", "FALSE" = "#0072B2") # Rojo para negativo, Azul para positivo
ggplot(tasa_inc_ENOE, aes(x = Fecha, y = Tasa_Anual)) +
# --- 1. Dibujar la Línea (Usaremos el color del punto anterior para la línea) ---
# El color de la línea será el color del punto al que está llegando.
geom_line(aes(color = Crecimiento_Negativo), size = 0.8) +
# --- 2. Dibujar Puntos con Color Condicional ---
geom_point(aes(color = Crecimiento_Negativo), size = 2.5) +
# --- 3. Añadir Etiquetas a TODOS los Puntos ---
geom_text(
aes(label = Tasa_Anual_Etiqueta, color = Crecimiento_Negativo),
# Posicionar la etiqueta:
# Ajustamos la posición vertical (vjust) para que no se superponga con el punto.
vjust = -1.0,
size = 3.5
) +
# --- 4. Aplicar el Esquema de Colores Definido ---
scale_color_manual(values = colores_crecimiento) +
# --- 5. Referencias y Formato ---
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") + # Línea de referencia en 0%
labs(
title = "Tasa de Crecimiento Anual del Ingreso Laboral Ponderado (ENOE)",
subtitle = "Variación Interanual (T/T-4) por trimestre",
x = "Fecha",
y = "Tasa de Crecimiento (%)"
) +
theme_minimal() +
scale_y_continuous(labels = function(x) paste0(x, "%")) +
scale_x_date(breaks = "1 year", date_labels = "%Y") + # Marcas principales cada año
theme(legend.position = "none") # Ocultar la leyenda de color, ya que es obvia
#Calculamos la tasa de variación anual
tasa_inc_ENOE<-tasa_inc_ENOE%>%
mutate(
# 1. Obtener la media del mismo trimestre del año anterior (t-4)
Media_Anual_Anterior = lag(Media, n = 4),
# 2. Calcular la Tasa de Variación Anual (TVA)
Tasa_Anual = ((Media - Media_Anual_Anterior) / Media_Anual_Anterior) * 100,
# Formato para la visualización
Tasa_Anual_Etiqueta = paste0(round(Tasa_Anual, 2), "%")
)
ggplot(tasa_inc_ENOE, aes(x = Fecha, y = Tasa_Anual)) +
geom_line(color = "darkred", size = 1) +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") + # Línea de referencia en 0%
# Añadir etiquetas solo al final de cada año para no saturar
geom_text(
data = subset(tasa_inc_ENOE, Trimestre == 4 | Fecha == max(Fecha)),
aes(label = Tasa_Anual_Etiqueta),
vjust = -0.5,
size = 3.5,
color = "darkred"
) +
labs(
title = "Tasa de Crecimiento Anual del Ingreso Laboral Ponderado (ENOE)",
subtitle = "Variación Interanual (T/T-4)",
x = "Fecha",
y = "Tasa de Crecimiento (%)"
) +
theme_minimal() +
scale_y_continuous(labels = function(x) paste0(x, "%"))
#GRaficamos con los picos más bajos de incremento
ggplot(tasa_inc_ENOE, aes(x = Fecha, y = Tasa_Anual)) +
# Dibujar la línea
geom_line(color = "gray", size = 1) +
# Añadir puntos con color condicional
geom_point(aes(color = Tasa_Anual < 0), size = 2) +
scale_color_manual(values = c("TRUE" = "darkred", "FALSE" = "#0072B2")) + # Rojo para crecimiento negativo
# Opcional: etiquetar solo el mínimo global
geom_text(
data = subset(tasa_inc_ENOE, Tasa_Anual == min(tasa_inc_ENOE$Tasa_Anual, na.rm = TRUE)),
aes(label = Tasa_Anual_Etiqueta),
vjust = 2,
color = "darkred",
size = 4
) +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
theme_minimal() +
theme(legend.position = "none") # Quitar la leyenda de color
ggplot(tasa_inc_ENOE, aes(x = Fecha, y = Tasa_Anual)) +
geom_line(color = "darkred", size = 1) +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") + # Línea de referencia en 0%
# Añadir etiquetas solo al final de cada año para no saturar
geom_text(
data = subset(tasa_inc_ENOE, Trimestre == 4 | Fecha == max(Fecha)),
aes(label = Tasa_Anual_Etiqueta),
vjust = -0.5,
size = 3.5,
color = "darkred"
) +
labs(
title = "Tasa de Crecimiento Anual del Ingreso Laboral Ponderado (ENOE)",
subtitle = "Variación Interanual (T/T-4)",
x = "Fecha",
y = "Tasa de Crecimiento (%)"
) +
theme_minimal() +
scale_y_continuous(labels = function(x) paste0(x, "%"))
ggplot(tasa_inc_ENOE, aes(x = Fecha, y = Tasa_Anual)) +
geom_line(color = "darkred", size = 1) +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") + # Línea de referencia en 0%
# Añadir etiquetas solo al final de cada año para no saturar
geom_text(
data = subset(tasa_inc_ENOE, Trimestre == 4 | Fecha == max(Fecha)),
aes(label = Tasa_Anual_Etiqueta),
vjust = -0.5,
size = 3.5,
color = "darkred"
) +
labs(
title = "Tasa de Crecimiento Anual del Ingreso Laboral Ponderado (ENOE)",
subtitle = "Variación Interanual (T/T-4)",
x = "Fecha",
y = "Tasa de Crecimiento (%)"
) +
theme_minimal() +
scale_y_continuous(labels = function(x) paste0(x, "%"))
ggplot(tasa_inc_ENOE, aes(x = Fecha, y = Tasa_Anual)) +
# --- 1. Dibujar la Línea (Usaremos el color del punto anterior para la línea) ---
# El color de la línea será el color del punto al que está llegando.
geom_line(aes(color = Crecimiento_Negativo), size = 0.8) +
# --- 2. Dibujar Puntos con Color Condicional ---
geom_point(aes(color = Crecimiento_Negativo), size = 2.5) +
# --- 3. Añadir Etiquetas a TODOS los Puntos ---
geom_text(
aes(label = Tasa_Anual_Etiqueta, color = Crecimiento_Negativo),
# Posicionar la etiqueta:
# Ajustamos la posición vertical (vjust) para que no se superponga con el punto.
vjust = -1.0,
size = 3.5
) +
# --- 4. Aplicar el Esquema de Colores Definido ---
scale_color_manual(values = colores_crecimiento) +
# --- 5. Referencias y Formato ---
geom_hline(yintercept = 0, linetype = "dashed", color = "gray") + # Línea de referencia en 0%
labs(
title = "Tasa de Crecimiento Anual del Ingreso Laboral Ponderado (ENOE)",
subtitle = "Variación Interanual (T/T-4) por trimestre",
x = "Fecha",
y = "Tasa de Crecimiento (%)"
) +
theme_minimal() +
scale_y_continuous(labels = function(x) paste0(x, "%")) +
scale_x_date(breaks = "1 year", date_labels = "%Y") + # Marcas principales cada año
theme(legend.position = "none") # Ocultar la leyenda de color, ya que es obvia
